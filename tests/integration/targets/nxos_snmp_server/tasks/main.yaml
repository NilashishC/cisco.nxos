---
- name: Get admin user SNMP data
  cisco.nxos.nxos_command:
    commands: show running | section '^snmp-server user'
  register: result

- name: Grep admin user SNMP localized key
  set_fact:
    admin_snmp_passwd: "{{ result['stdout'][0] | regex_search('snmp-server user admin network-admin auth (md5|sha) (\\S+)', '\\2') }}"
    ansible_snmp_passwd: "{{ result['stdout'][0] | regex_search('snmp-server user ansible network-admin auth (md5|sha) (\\S+)', '\\2') }}"
    admin_priv_passwd: "{{ result['stdout'][0] | regex_search('snmp-server user admin network-admin auth (md5|sha) (\\S+) priv (\\S+)', '\\3') }}"
    ansible_priv_passwd: "{{ result['stdout'][0] | regex_search('snmp-server user ansible network-admin auth (md5|sha) (\\S+) priv (\\S+)', '\\3') }}"

- name: Include the CLI tasks
  ansible.builtin.include_tasks: cli.yaml
  tags:
    - cli.yaml

- name: Include the NX-API tasks
  ansible.builtin.include_tasks: nxapi.yaml
  tags:
    - nxapi
